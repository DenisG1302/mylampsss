<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Обновление прошивки ESP8266</title>
</head>
<body>
  <h1>Обновление прошивки ESP8266</h1>
  <button id="updateButton" disabled>Проверка версии...</button>
  <script>
    function updateFirmware() {
      fetch('/update')
        .then(response => response.text())
        .then(text => {
          if (text === 'Update successful. Device is rebooting...') {
            alert('Обновление успешно. Устройство перезагружается...');
          } else {
            alert('Ошибка обновления: ' + text);
          }
        });
    }

    fetch('/version')
      .then(response => response.text())
      .then(version => {
        if (version) {
          document.getElementById('updateButton').textContent = 'Обновить до версии: ' + version;
          document.getElementById('updateButton').disabled = false;
          document.getElementById('updateButton').onclick = updateFirmware;
        } else {
          document.getElementById('updateButton').textContent = 'Нет новой версии';
          document.getElementById('updateButton').disabled = true;
        }
      });
  </script>
</body>
</html>
